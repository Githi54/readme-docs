---
export const prerender = true;

import DocsLayout from "../layouts/DocsLayout.astro";
import "../styles/global.css";
---

<DocsLayout title="Generate WalkThrough | README Docs" variant="landing">
    <section
        class="relative min-h-[calc(100vh-4rem)] flex items-center justify-center py-16 overflow-hidden"
    >
        <!-- Background decorations -->
        <div class="absolute inset-0 overflow-hidden pointer-events-none">
            <div
                class="absolute top-[-10%] left-[10%] w-[50%] h-[50%] bg-indigo-900/20 rounded-full blur-[120px]"
            >
            </div>
            <div
                class="absolute bottom-[-10%] right-[10%] w-[40%] h-[40%] bg-purple-900/20 rounded-full blur-[100px]"
            >
            </div>
        </div>

        <div
            class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10 w-full"
        >
            <!-- Header -->
            <div class="text-center mb-12">
                <h1
                    class="text-4xl font-extrabold text-white sm:text-5xl md:text-6xl mb-6 text-glow"
                >
                    <span class="block">Generate Documentation</span>
                    <span
                        class="block text-indigo-400 bg-clip-text text-transparent bg-gradient-to-r from-indigo-400 to-purple-400"
                    >
                        From Your Repository
                    </span>
                </h1>
                <p
                    class="text-xl text-gray-400 max-w-2xl mx-auto leading-relaxed"
                >
                    Transform your GitHub README into beautiful, shareable
                    documentation.
                    <br class="hidden md:block" />
                    Enter a repository URL and get instant documentation.
                </p>
            </div>

            <!-- Form Card -->
            <div class="relative">
                <div
                    class="absolute inset-0 bg-gradient-to-r from-indigo-600/20 to-purple-600/20 rounded-2xl blur-xl"
                >
                </div>

                <div
                    class="relative bg-white/5 backdrop-blur-md border border-white/10 rounded-2xl p-8 shadow-2xl"
                >
                    <form id="generateForm" class="space-y-6">
                        <!-- Input Field -->
                        <div>
                            <label
                                for="repoUrl"
                                class="block text-sm font-medium text-gray-300 mb-2"
                            >
                                GitHub Repository
                            </label>
                            <input
                                type="text"
                                id="repoUrl"
                                name="repoUrl"
                                placeholder="owner/repo or https://github.com/owner/repo"
                                class="w-full px-4 py-3 bg-white/5 border border-white/10 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all"
                                required
                            />
                            <p class="mt-2 text-sm text-gray-500">
                                Example: facebook/react or
                                https://github.com/facebook/react
                            </p>
                        </div>

                        <!-- Error Message -->
                        <div
                            id="errorMessage"
                            class="hidden p-4 bg-red-500/10 border border-red-500/20 rounded-lg"
                        >
                            <p
                                class="text-sm text-red-400 flex items-center gap-2"
                            >
                                <svg
                                    class="w-5 h-5"
                                    fill="currentColor"
                                    viewBox="0 0 20 20"
                                >
                                    <path
                                        fill-rule="evenodd"
                                        d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z"
                                        clip-rule="evenodd"></path>
                                </svg>
                                <span id="errorText"></span>
                            </p>
                        </div>

                        <!-- Success Message -->
                        <div
                            id="successMessage"
                            class="hidden p-4 bg-green-500/10 border border-green-500/20 rounded-lg"
                        >
                            <p
                                class="text-sm text-green-400 flex items-center gap-2"
                            >
                                <svg
                                    class="w-5 h-5"
                                    fill="currentColor"
                                    viewBox="0 0 20 20"
                                >
                                    <path
                                        fill-rule="evenodd"
                                        d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                                        clip-rule="evenodd"></path>
                                </svg>
                                <span id="successText"></span>
                            </p>
                        </div>

                        <!-- Submit Button -->
                        <button
                            type="submit"
                            id="submitButton"
                            class="w-full inline-flex items-center justify-center px-8 py-4 border border-transparent text-lg font-medium rounded-lg text-white bg-indigo-600 hover:bg-indigo-500 transition-all shadow-[0_0_20px_rgba(99,102,241,0.5)] hover:shadow-[0_0_30px_rgba(99,102,241,0.7)] disabled:opacity-50 disabled:cursor-not-allowed"
                        >
                            <span id="buttonText">Generate Documentation</span>
                            <svg
                                id="buttonIcon"
                                class="ml-2 -mr-1 w-5 h-5"
                                fill="none"
                                stroke="currentColor"
                                viewBox="0 0 24 24"
                            >
                                <path
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                    stroke-width="2"
                                    d="M13 7l5 5m0 0l-5 5m5-5H6"></path>
                            </svg>
                            <svg
                                id="loadingSpinner"
                                class="hidden ml-2 -mr-1 w-5 h-5 animate-spin"
                                fill="none"
                                viewBox="0 0 24 24"
                            >
                                <circle
                                    class="opacity-25"
                                    cx="12"
                                    cy="12"
                                    r="10"
                                    stroke="currentColor"
                                    stroke-width="4"></circle>
                                <path
                                    class="opacity-75"
                                    fill="currentColor"
                                    d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
                                ></path>
                            </svg>
                        </button>

                        <!-- Info Box -->
                        <div
                            class="mt-6 p-4 bg-indigo-500/5 border border-indigo-500/20 rounded-lg"
                        >
                            <h3
                                class="text-sm font-semibold text-indigo-300 mb-2"
                            >
                                What you'll get:
                            </h3>
                            <ul class="text-sm text-gray-400 space-y-1">
                                <li class="flex items-start gap-2">
                                    <svg
                                        class="w-4 h-4 text-indigo-400 mt-0.5 flex-shrink-0"
                                        fill="currentColor"
                                        viewBox="0 0 20 20"
                                    >
                                        <path
                                            fill-rule="evenodd"
                                            d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                                            clip-rule="evenodd"></path>
                                    </svg>
                                    <span
                                        >Beautiful, formatted documentation from
                                        your README</span
                                    >
                                </li>
                                <li class="flex items-start gap-2">
                                    <svg
                                        class="w-4 h-4 text-indigo-400 mt-0.5 flex-shrink-0"
                                        fill="currentColor"
                                        viewBox="0 0 20 20"
                                    >
                                        <path
                                            fill-rule="evenodd"
                                            d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                                            clip-rule="evenodd"></path>
                                    </svg>
                                    <span
                                        >Shareable link for your entire team</span
                                    >
                                </li>
                                <li class="flex items-start gap-2">
                                    <svg
                                        class="w-4 h-4 text-indigo-400 mt-0.5 flex-shrink-0"
                                        fill="currentColor"
                                        viewBox="0 0 20 20"
                                    >
                                        <path
                                            fill-rule="evenodd"
                                            d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                                            clip-rule="evenodd"></path>
                                    </svg>
                                    <span
                                        >No setup required - works instantly</span
                                    >
                                </li>
                            </ul>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </section>
</DocsLayout>

<script>
    const form = document.getElementById("generateForm") as HTMLFormElement;
    const input = document.getElementById("repoUrl") as HTMLInputElement;
    const submitButton = document.getElementById(
        "submitButton",
    ) as HTMLButtonElement;
    const buttonText = document.getElementById("buttonText") as HTMLSpanElement;
    const buttonIcon = document.getElementById(
        "buttonIcon",
    ) as unknown as SVGElement;
    const loadingSpinner = document.getElementById(
        "loadingSpinner",
    ) as unknown as SVGElement;
    const errorMessage = document.getElementById(
        "errorMessage",
    ) as HTMLDivElement;
    const errorText = document.getElementById("errorText") as HTMLSpanElement;
    const successMessage = document.getElementById(
        "successMessage",
    ) as HTMLDivElement;
    const successText = document.getElementById(
        "successText",
    ) as HTMLSpanElement;

    function showError(message: string) {
        errorText.textContent = message;
        errorMessage.classList.remove("hidden");
        successMessage.classList.add("hidden");
    }

    function showSuccess(message: string) {
        successText.textContent = message;
        successMessage.classList.remove("hidden");
        errorMessage.classList.add("hidden");
    }

    function hideMessages() {
        errorMessage.classList.add("hidden");
        successMessage.classList.add("hidden");
    }

    function setLoading(loading: boolean) {
        submitButton.disabled = loading;
        if (loading) {
            buttonText.textContent = "Generating...";
            buttonIcon.classList.add("hidden");
            loadingSpinner.classList.remove("hidden");
        } else {
            buttonText.textContent = "Generate Documentation";
            buttonIcon.classList.remove("hidden");
            loadingSpinner.classList.add("hidden");
        }
    }

    function parseRepositoryUrl(input: string): {
        valid: boolean;
        owner?: string;
        repo?: string;
    } {
        const trimmed = input.trim();

        // Pattern 1: owner/repo
        const shorthandRegex = /^([a-zA-Z0-9_-]+)\/([a-zA-Z0-9_.-]+)$/;
        const shorthandMatch = trimmed.match(shorthandRegex);
        if (shorthandMatch) {
            return {
                valid: true,
                owner: shorthandMatch[1],
                repo: shorthandMatch[2],
            };
        }

        // Pattern 2: https://github.com/owner/repo
        const fullUrlRegex =
            /^https?:\/\/github\.com\/([a-zA-Z0-9_-]+)\/([a-zA-Z0-9_.-]+)\/?$/;
        const fullUrlMatch = trimmed.match(fullUrlRegex);
        if (fullUrlMatch) {
            return {
                valid: true,
                owner: fullUrlMatch[1],
                repo: fullUrlMatch[2],
            };
        }

        return { valid: false };
    }

    form.addEventListener("submit", async (e) => {
        e.preventDefault();
        hideMessages();

        const inputValue = input.value.trim();

        if (!inputValue) {
            showError("Please enter a repository URL");
            return;
        }

        const parsed = parseRepositoryUrl(inputValue);

        if (!parsed.valid) {
            showError(
                "Invalid repository format. Use: owner/repo or https://github.com/owner/repo",
            );
            return;
        }

        setLoading(true);

        try {
            // Show generating message
            showSuccess(
                `Generating documentation for ${parsed.owner}/${parsed.repo}...`,
            );

            // Small delay for UX feedback
            await new Promise((resolve) => setTimeout(resolve, 500));

            // Redirect to docs page - docs will be fetched on demand
            window.location.href = `/docs/${parsed.owner}/${parsed.repo}`;
        } catch (error) {
            showError("Error generating documentation. Please try again.");
            console.error("Generation error:", error);
            setLoading(false);
        }
    });
</script>
