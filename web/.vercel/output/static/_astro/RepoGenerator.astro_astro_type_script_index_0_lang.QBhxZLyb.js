function d(c){const t=c.trim(),s=/^([a-zA-Z0-9_-]+)\/([a-zA-Z0-9_.-]+)$/,e=t.match(s);if(e)return{valid:!0,owner:e[1],repo:e[2]};const r=/^https?:\/\/github\.com\/([a-zA-Z0-9_-]+)\/([a-zA-Z0-9_.-]+)\/?$/,i=t.match(r);return i?{valid:!0,owner:i[1],repo:i[2]}:{valid:!1}}async function p(c,t){try{const s=await fetch("/api/validate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({owner:c,repo:t})});if(!s.ok)throw s.status===404?new Error("Repository not found or private"):new Error("Validation failed");return!0}catch(s){throw s}}class u extends HTMLElement{form;input;submitButton;buttonText;buttonIcon;loadingSpinner;errorMessage;errorText;successContainer;repoNameDisplay;viewDemoBtn;downloadBtn;progressSteps;stepItems;stepTimers=[];constructor(){super(),this.form=this.querySelector("#generate-form"),this.input=this.querySelector("#repo-url"),this.submitButton=this.querySelector("#submit-button"),this.buttonText=this.querySelector("#button-text"),this.buttonIcon=this.querySelector("#button-icon"),this.loadingSpinner=this.querySelector("#loading-spinner"),this.errorMessage=this.querySelector("#error-message"),this.errorText=this.querySelector("#error-text"),this.successContainer=this.querySelector("#success-container"),this.repoNameDisplay=this.querySelector("#repo-name-display"),this.viewDemoBtn=this.querySelector("#view-demo-btn"),this.downloadBtn=this.querySelector("#download-btn"),this.progressSteps=this.querySelector("#progress-steps"),this.stepItems=this.querySelectorAll(".step-item"),this.form.addEventListener("submit",this.handleSubmit.bind(this))}connectedCallback(){const t=this.dataset.initialRepo;t&&(this.input.value=t)}showLoading(t){this.submitButton.disabled=t,t?(this.buttonText.textContent="Generating...",this.buttonIcon.classList.add("hidden"),this.loadingSpinner.classList.remove("hidden"),this.startProgressSteps()):(this.buttonText.textContent="Generate Documentation",this.buttonIcon.classList.remove("hidden"),this.loadingSpinner.classList.add("hidden"))}startProgressSteps(){this.stepTimers.forEach(e=>clearTimeout(e)),this.stepTimers=[],this.progressSteps.classList.remove("hidden"),this.stepItems.forEach(e=>{const r=e.querySelector(".step-icon"),i=e.querySelector(".step-spinner"),a=e.querySelector(".step-check"),n=e.querySelector(".step-label"),o=e.querySelector(".step-time");r.className="step-icon w-6 h-6 rounded-full bg-gray-700/50 border border-gray-600/50 flex items-center justify-center flex-shrink-0",i.classList.add("hidden"),a.classList.add("hidden"),n.classList.remove("text-gray-300"),n.classList.add("text-gray-500"),o.classList.add("hidden"),o.textContent="",e.style.opacity="0.5"});const t=[800,1200,400,1600];let s=0;this.stepItems.forEach((e,r)=>{const i=window.setTimeout(()=>{const n=e.querySelector(".step-spinner"),o=e.querySelector(".step-label");n.classList.remove("hidden"),o.classList.remove("text-gray-500"),o.classList.add("text-gray-300"),e.style.opacity="1",e.style.transition="opacity 0.3s ease"},s);this.stepTimers.push(i),s+=t[r];const a=window.setTimeout(()=>{const n=e.querySelector(".step-icon"),o=e.querySelector(".step-spinner"),h=e.querySelector(".step-check"),l=e.querySelector(".step-time");n.className="step-icon w-6 h-6 rounded-full bg-green-500/20 border border-green-500/40 flex items-center justify-center flex-shrink-0",o.classList.add("hidden"),h.classList.remove("hidden"),l.classList.remove("hidden"),l.textContent=`${(t[r]/1e3).toFixed(1)}s`},s);this.stepTimers.push(a),s+=200})}completeAllSteps(){this.stepTimers.forEach(s=>clearTimeout(s)),this.stepTimers=[];const t=[.8,1.2,.4,1.6];this.stepItems.forEach((s,e)=>{const r=s.querySelector(".step-icon"),i=s.querySelector(".step-spinner"),a=s.querySelector(".step-check"),n=s.querySelector(".step-label"),o=s.querySelector(".step-time");r.className="step-icon w-6 h-6 rounded-full bg-green-500/20 border border-green-500/40 flex items-center justify-center flex-shrink-0",i.classList.add("hidden"),a.classList.remove("hidden"),n.classList.remove("text-gray-500"),n.classList.add("text-gray-300"),o.classList.remove("hidden"),o.textContent=`${t[e]}s`,s.style.opacity="1"})}hideProgressSteps(){this.stepTimers.forEach(t=>clearTimeout(t)),this.stepTimers=[],this.progressSteps.classList.add("hidden")}showError(t){this.errorText.textContent=t,this.errorMessage.classList.remove("hidden"),this.hideProgressSteps(),this.successContainer.classList.add("hidden"),this.successContainer.classList.remove("opacity-100","translate-y-0")}showSuccess(t){this.errorMessage.classList.add("hidden"),this.completeAllSteps(),this.repoNameDisplay.textContent=`${t.owner}/${t.repo}`,this.viewDemoBtn.href=`/docs/${t.owner}/${t.repo}`,this.downloadBtn.onclick=()=>{window.location.href=`/api/download?owner=${t.owner}&repo=${t.repo}`},this.successContainer.classList.remove("hidden"),this.successContainer.scrollIntoView({behavior:"smooth",block:"center"}),setTimeout(()=>{this.successContainer.classList.add("translate-y-0","opacity-100"),this.successContainer.classList.remove("-translate-y-4")},10)}async handleSubmit(t){t.preventDefault(),this.errorMessage.classList.add("hidden");const s=this.input.value.trim();if(!s){this.showError("Please enter a repository URL");return}const e=d(s);if(!e.valid||!e.owner||!e.repo){this.showError("Invalid repository format. Use: owner/repo or https://github.com/owner/repo");return}this.showLoading(!0);try{await p(e.owner,e.repo),this.showSuccess({owner:e.owner,repo:e.repo})}catch(r){this.showError(r.message||"Error generating documentation. Please try again."),console.error("Generation error:",r)}finally{this.showLoading(!1)}}}customElements.define("repo-generator",u);
